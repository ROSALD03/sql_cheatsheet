Select count(distinct case when orals_flag=1 then A.patient_month_identifier end) AS OAV_TREATED_PATIENTS, 
count (DISTINCT CASE WHEN (COVID_DX_FLAG =1 OR COVID_TX_FLAG=1) AND HR_12_PLUS=1 THEN A.patient_month_identifier END) AS "12+HR_DIAGNOSED_OR_TREATED_PATIENTS",
div0(OAV_TREATED_PATIENTS,"12+HR_DIAGNOSED_OR_TREATED_PATIENTS") AS TX_RATE

from "VAW_AMER_PUB"."GLOBAL_INDUSTRIALIZATION_REPO"."PAXLOVID_LAAD_COVID_DX_TX_CLAIMS_UNIVERSE" A
LEFT JOIN 
(SELECT * FROM VAW_AMER_PUB."GLOBAL_INDUSTRIALIZATION_REPO"."PAXLOVID_LAAD_DIM_HIGH_RISK" WHERE HR_12_PLUS=1) B
ON A."PATIENT_ID" = B."PATIENT_ID"
where a.svc_dt between '2023-08-05' and '2024-02-05'
